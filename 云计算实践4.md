# 云计算实践-4

---



时间：2025.10.23

实践名称：在阿里云上部署discuz论坛

学生：谢婉茹

学号：202113370039

老师：吴军



---

## 实验内容

### 任务一：创建VPC网络



登录阿里云平台配置专有网络![image-20251023113917212](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023113917212.png)

然后在专有网络下配置对应的交换机

![image-20251023113941444](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023113941444.png)

交换机的可用区与VPC属同一地域下

配置成功后如下图

![image-20251023114008586](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023114008586.png)

然后配置安全组，

![image-20251023114456242](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023114456242.png)

![image-20251023114441185](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023114441185.png)

### 任务二：创建和配置 ECS

在创建的VPN上新建一台服务器

![image-20251023131056767](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023131056767.png)

![image-20251023131112643](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023131112643.png)

后来发现centos不能安装对应的一些工具，arm版本太低了，后来反过来又重新选择了操作系统。



![image-20251023131133145](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023131133145.png)

![image-20251023131202784](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023131202784.png)

![image-20251023131217566](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023131217566.png)

这里选择了新的架构ubuntu，您会发现对应的公网ip也不对了。是因为我推倒重来了。之后就顺利了。

![image-20251023164302046](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023164302046.png)



然后在mac终端修改密钥文件权限为600之后ssh连接到服务器

![image-20251023164618432](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023164618432.png)

### 任务三：安装 MySQL

可以替代 CDB，本地存储数据

使用 Ubuntu 官方仓库安装 MySQL，无需额外付费，直接作为 Discuz 的数据库。

#### 1.1 安装 MySQL Server





![image-20251023164912448](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023164912448.png)



```bash
sudo apt install -y mysql-server libmysqlclient-dev
```

- `mysql-server`：MySQL 核心服务
- `libmysqlclient-dev`：PHP 连接 MySQL 所需的开发库

#### 1.2 启动并设置 MySQL 开机自启

![image-20251023164938555](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023164938555.png)

```bash
# 启动MySQL服务
sudo systemctl start mysql
# 设置开机自启
sudo systemctl enable mysql
# 检查状态（显示active(running)即正常）
sudo systemctl status mysql
```

#### 1.3 配置 MySQL

用来设置密码 + 授权 Discuz 访问

Ubuntu 安装 MySQL 后默认无初始密码，需手动配置 root 密码并授权本地访问：

1. **登录 MySQL**

   ```bash
   sudo mysql -u root
   ```

   

2. **设置 root 密码（密码设置为111**）**

   

   `ALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY  '111' `

   

   ![image-20251023165245995](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023165245995.png)

   

   

3. **验证登录（用新密码测试）**

   ```bash
   sudo mysql -u root -p
   ```

   

   输入刚才设置的密码，能进入 MySQL 命令行即配置成功。

#### 1.4 为 Discuz 创建专用数据库与用户

为避免直接用 root 操作，创建一个仅用于 Discuz 的数据库和用户：

1. 登录 MySQL 后执行：

2. ![image-20251023165409505](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023165409505.png)

   ```sql
   -- 1. 创建Discuz专用数据库（名称建议用discuz，方便识别）
   CREATE DATABASE discuz CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
   -- 2. 创建用户（用户名discuz_user，密码DiscuzDB@2025，可自定义）
   CREATE USER 'discuz_user'@'localhost' IDENTIFIED BY 'DiscuzDB@2025';
   -- 3. 授予用户操作discuz数据库的所有权限
   GRANT ALL PRIVILEGES ON discuz.* TO 'discuz_user'@'localhost';
   -- 4. 刷新权限
   FLUSH PRIVILEGES;
   -- 退出
   EXIT;
   ```

   

- 后续 Discuz 安装时，数据库参数将用此`discuz_user`和密码，更安全。

### 任务三：安装 Web 环境

主要目的是（Nginx+PHP，处理 Discuz 网页请求）。

Discuz 是 PHP 程序，需搭配 Web 服务器（Nginx）和 PHP 运行环境。

#### 3.1 安装 Nginx（Web 服务器）



![image-20251023165504518](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023165504518.png)

```bash
sudo apt install -y nginx
# 启动并设置开机自启
sudo systemctl start nginx
sudo systemctl enable nginx
# 检查状态（active(running)即正常）
sudo systemctl status nginx
```



#### 3.2 安装 PHP 及 Discuz 所需扩展

Discuz 依赖 PHP 的 MySQL、GD（图片处理）、curl（网络请求）等扩展，安装命令：

![image-20251023165707705](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023165707705.png)

```bash
# 安装PHP 8.3（Ubuntu 24.04默认版本）及扩展
sudo apt install -y php8.3 php8.3-fpm php8.3-mysql php8.3-gd php8.3-curl php8.3-mbstring php8.3-xml php8.3-zip
```

- `php8.3-fpm`：PHP FastCGI 进程管理器（Nginx 需通过它解析 PHP）
- 其他扩展：均为 Discuz 必需（如`php8.3-mysql`用于连接 MySQL）

#### 3.3 启动 PHP-FPM 并设置自启



![image-20251023165810903](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023165810903.png)

```bash
sudo systemctl start php8.3-fpm
sudo systemctl enable php8.3-fpm
# 检查状态（active(running)即正常）
sudo systemctl status php8.3-fpm
```

### 任务四：配置 Nginx 支持 PHP

默认 Nginx 不处理 PHP，需修改配置文件，让`.php`文件通过 PHP-FPM 解析。

#### 4.1 编辑 Nginx 默认配置文件

```bash
sudo nano /etc/nginx/sites-available/default
```

#### 4.2 修改配置

配置的关键在于（关键：让 Nginx 解析 Discuz 的 PHP 文件）

找到`server { ... }`块，替换为以下配置（主要添加 PHP 解析规则）：

![image-20251023170128379](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170128379.png)



#### 4.3 保存配置并验证

- 按 `Ctrl+O` 保存，`Ctrl+X` 退出编辑器。

- 验证 Nginx 配置是否正确（无报错即正常）

  ![image-20251023170238466](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170238466.png)

  

  ```bash
  sudo nginx -t
  ```

  

- 重启 Nginx 使配置生效：

  

  ![image-20251023170254760](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170254760.png)

  ```bash
  sudo systemctl restart nginx
  ```

  

### 任务五：下载并部署 Discuz 程序

#### 5.1 安装解压工具

```bash
sudo apt install -y unzip
```

#### 5.2 下载 Discuz 

一个老的版本，但是更稳定

但是还是推荐使用最新的版本，相关链接放在了文章最后。

进入网站根目录`/var/www/html`，下载并解压 Discuz：（是在git上用克隆仓库下载的）

![image-20251023170449589](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170449589.png)



#### 5.3 设置 Discuz 目录权限

Discuz 需要写入权限（如配置文件、附件存储），执行以下命令授权：

![image-20251023170544458](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170544458.png)







![image-20251023170645781](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170645781.png)

```bash
# 授予www-data用户（Nginx/PHP运行用户）所有权
sudo chown -R www-data:www-data /var/www/html
# 目录权限755（允许进入），文件权限644（允许读写）
sudo find /var/www/html -type d -exec chmod 755 {} \;
sudo find /var/www/html -type f -exec chmod 644 {} \;
# 给关键目录额外写入权限（安装和发帖必需）
sudo chmod -R 775 /var/www/html/data /var/www/html/config /var/www/html/uc_client/data
```

### 任务六：浏览器完成 Discuz 安装

此时服务器端配置已完成，通过本地浏览器即可完成最后安装。

#### 6.1 访问 Discuz 安装页面

打开本地浏览器（Chrome/Firefox），输入服务器公网 IP：

![image-20251023170738214](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023170738214.png)

```plaintext
http://118.178.99.214/install
```

- 若出现 “Discuz 安装向导” 页面，说明前面配置正常。
- ![image-20251023171001432](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023171001432.png)

#### 6.2 按向导完成安装

##### 第一步：同意协议并选择安装模式

- 点击【我同意】→ 选择【全新安装 Discuz! X（含 UCenter Server）】→ 点击【下一步】。

##### 第二步：环境检查与数据库配置

- 数据库配置（关键！填写步骤 1 中 MySQL 的信息）：![](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023171600574.png)

  | 配置项       | 填写内容（按你实际设置）                                 |
  | ------------ | -------------------------------------------------------- |
  | 数据库服务器 | [localhost](https://localhost/)（本地 MySQL，无需填 IP） |
  | 数据库名     | discuz（步骤 1.4 创建的数据库）                          |
  | 数据库用户名 | discuz_user（步骤 1.4 创建的用户，或 root）              |
  | 数据库密码   | DiscuzDB@2025（步骤 1.4 设置的密码）                     |
  | 数据表前缀   | pre_（默认，无需修改）                                   |

- 管理员配置（设置 Discuz 后台账号）：

  - 管理员账号：admin（自定义，如 your_admin）
  - 管理员密码：设置复杂密码（如 DiscuzAdmin@2025）![image-20251023171226847](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023171226847.png)

- 点击【下一步】，等待安装完成。

- ![image-20251023171616204](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023171616204.png)

### 七、任务七：测试基础功能

主要是发一个帖子验证一下；



1. **访问 Discuz 首页**浏览器输入 `http://118.178.99.214`，显示论坛首页即正常。
2. **登录管理员账号**点击右上角【登录】，输入步骤 6.2 设置的管理员账号和密码。
3. **发表测试帖子**
4. ![image-20251023171731588](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023171731588.png)
   - 进入【默认版块】→ 点击【发表帖子】
   - 输入标题（如 “测试发帖”）和内容（如 “Discuz 部署成功！”）
   - 点击【发表】，若能成功发布并显示帖子，说明部署完成。![image-20251023171806695](/Users/rileyj_g/Library/Application Support/typora-user-images/image-20251023171806695.png)

这个实验主要是用于。无需购买 CDB 和 CFS，即可实现 Discuz 基础发帖功能，全程零额外费用。

相比于实验指导手册上的腾讯云布置，更加多的细节，但是不收费。



### 相关链接



相关参考链接

https://cloud.tencent.com/document/product/213/8043

discuz的下载链接（最新版）

https://gitee.com/Discuz/DiscuzX/releases/download/v3.5-20250901/Discuz_X3.5_TC_UTF8_20250901.zip



